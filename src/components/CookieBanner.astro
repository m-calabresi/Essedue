<div
    id="cookie-banner"
    class="animate-appear fixed end-0 -bottom-5 z-50 m-4 flex flex-col gap-4 bg-white p-4 text-black opacity-0 shadow-lg shadow-gray-400 md:w-md">
    <button
        aria-label="Chiudi banner dei cookies"
        class="action-close w-fit self-end px-1 capitalize transition-colors duration-300 hover:cursor-pointer focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-4 focus-visible:ring-offset-white focus-visible:outline-none">
        <span class="mx-auto my-1.5 block h-0.5 w-4 translate-y-1 rotate-45 bg-black"></span>
        <span class="mx-auto my-1.5 block h-0.5 w-4 -translate-y-1 -rotate-45 bg-black"></span>
    </button>
    <span class="text-[0.8rem]">
        Questo sito utilizza esclusivamente cookie tecnici. Non vengono utilizzati cookie di marketing o di
        tracciamento di terze parti. Per maggiori informazioni consulta la nostra
        <a
            aria-label="Link alla Cookie Policy"
            class="font-semibold underline focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-4 focus-visible:ring-offset-white focus-visible:outline-none"
            href="/cookie-policy">
            Cookie Policy</a
        >.
    </span>
    <button
        aria-label="Chiudi banner dei cookies"
        class="action-close text-2xs block w-full self-end border-[3px] border-black bg-black p-[0.4rem] text-center leading-7 font-extrabold tracking-wider text-white uppercase transition-colors duration-300 hover:cursor-pointer hover:text-gray-400 focus-visible:text-gray-400 focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-4 focus-visible:ring-offset-white focus-visible:outline-none">
        chiudi
    </button>
</div>

<script>
    import Cookies from "js-cookie";

    const preferenceCookie = "preference_expressed";
    const cookieBanner = document.getElementById("cookie-banner")!;

    if (!!Cookies.get(preferenceCookie)) {
        cookieBanner.classList.remove("flex");
        cookieBanner.classList.add("hidden");
    }

    const closeButtons = document.querySelectorAll(".action-close") as NodeListOf<HTMLButtonElement>;

    const closeCookieBanner = () => {
        cookieBanner.classList.remove("animate-appear", "-bottom-5", "opacity-0");
        cookieBanner.classList.add("animate-disappear", "bottom-0", "opacity-100");

        const nextYear = new Date(new Date().setFullYear(new Date().getFullYear() + 1));

        Cookies.set(preferenceCookie, "1", {
            expires: nextYear,
            secure: true,
            sameSite: "strict",
        });
    };

    closeButtons.forEach((item) => (item.onclick = closeCookieBanner));
</script>
